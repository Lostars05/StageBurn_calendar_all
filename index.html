<!DOCTYPE html>
<html>
    <head>
        <title>Stage Burn</title>
        <style>
            body {
                background-color: rgb(25, 25, 25);;
                color: ghostwhite;
            }
            table {
                width: 100%;
                border-spacing: 0;
            }
            th {
                text-align: center;
                font-size: 30px;
                color:ghostwhite;
                background-color: black;
                padding: 20px;
                letter-spacing: 2px;
            }
            .top-bar {
                display: flex;
                justify-content: center; /*가로 방향 가운데 정렬*/
                align-items: center; /*세로 방향 가운데 정렬*/
                position: relative;
                background-color: black;
                color: ghostwhite;
                padding: 20px;
                font-family: 'Malgun Gothic', sans-serif;
                font-size: 18px;
                letter-spacing: 1px;
            }
            .center-text {
                text-align: center;
                flex: 1; /* 가운데 영역이 확장 */
            }
        </style>
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/main.min.css" rel="stylesheet">
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
    </head>
    <body>
        <table>
            <tr>
                <th>
                    <div> </div>
                    <div class="top-bar">
                        <div class="center-text" style="font-size:20px; font-family: 'Malgun Gothic', sans-serif;">Stage Burn</div>
                    </div>
                </th>
            </tr>
        </table>
    <div id="calendar"></div>
    <div id="eventDetailBox" style="display: none; padding: 20px; background-color: #222; color: ghostwhite; margin-top: 30px; border-radius: 8px;">
        <h3 id="eventTitle" style="margin-bottom: 10px;"></h3>
        <ul id="eventDescList" style="list-style: disc; padding-left: 20px;"></ul>
    </div>
    <script>
        
        window.onload = function(){
            document.getElementById('closeButton').classList.add('hidden');
        };
        fetch("https://docs.google.com/spreadsheets/d/1SZE6sIO6wE-OZByk_7mBvM9jY8PvSj1OKSaLbU4z8ec/gviz/tq?tqx=out:json")
            .then(res => res.text())
            .then(data => {
            const json = JSON.parse(data.substr(47).slice(0, -2));
            const rows = json.table.rows;
        rows.slice(1).forEach(row => {
            const rawDate = row.c[0]?.v;
            const title = row.c[1]?.v || "";
            const desc = row.c[2]?.v || "";
            const dateObj = new Date(rawDate);
            const dateStr = dateObj.toISOString().split("T")[0];
            console.log(`${dateStr}: ${title} - ${desc}`);
            });
        });

        document.addEventListener('DOMContentLoaded', function () {
            const calendarEl = document.getElementById('calendar');

            const calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                events: async function(fetchInfo, successCallback, failureCallback) {
                    try {
                        const res = await fetch("https://docs.google.com/spreadsheets/d/1SZE6sIO6wE-OZByk_7mBvM9jY8PvSj1OKSaLbU4z8ec/gviz/tq?tqx=out:json");
                        const text = await res.text();
                        const json = JSON.parse(text.substr(47).slice(0, -2));
                        const rows = json.table.rows;

                        const events = rows.slice(1).map(row => {
                            const rawDate = row.c[0]?.v;
                            const title = row.c[1]?.v || "";
                            const descParts = [];
                            for(let i=2; i<row.c.length; i++){
                                const part = row.c[i]?.v;
                                if(part) descParts.push(part);
                            }
                            const desc = descParts.join("\n");
                            if(!rawDate||!title) return null;
                            let dateStr;
                            if(typeof rawDate == "string"){
                                dateStr = rawDate.split("T")[0];
                            } else{
                                const dateObj = new Date(rawDate);
                                dateStr = dateObj.toISOString().split("T")[0];
                            }
                            return{
                                title: title,
                                start: dateStr,
                                description: desc
                            };
                            }).filter(e => e);

                    successCallback(events);
                    } catch (error) {
                        failureCallback(error);
                        }
                    },
                    eventClick: function(info){
                        const title = info.event.title;
                        const desc = info.event.extendedProps.description;
                        const descLines = desc?desc.split("\n"):["None"];
                        document.getElementById("eventTitle").textContent = title;
                        const descList = document.getElementById("eventDescList");
                        descList.innerHTML = "";
                        descLines.forEach(line => {
                            const li = document.createElement("li");
                            li.textContent = line;
                            descList.appendChild(li);
                        });
                        document.getElementById("eventDetailBox").style.display="block";
                    }
                });
            calendar.render();
        });
    </script>
    </body>
</html>